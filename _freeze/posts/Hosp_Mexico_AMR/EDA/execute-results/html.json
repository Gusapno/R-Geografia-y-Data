{
  "hash": "d530a985087a3be4ac7b316db21514a0",
  "result": {
    "markdown": "---\ntitle: \"Análisis Exploratorio de Datos AMR\"\nauthor: \"Gabriel Ramírez\"\nformat: html\neditor: visual\nbibliography: references.bib\n---\n\n\n## Análisis Descriptivo de Datos Hospital México\n\nSe realiza un análisis descriptivo de la base de datos de los pacientes del Hospital México y las posibles resistencias y/o multiresistencias de los microorganismos a los antimicrobianos. Librerías utilizadas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DBI) # Interfaz de base de datos\nlibrary(RPostgres) # Para conectar con PSQL\nlibrary(sf) # Spatial Features, para manejar datos espaciales\n#library(rgeos) # Remover\nlibrary(openxlsx) # Para abrir documentos de Excel\nlibrary(data.table) # Para manejo de tablas\n#library(rgdal) # Remover\nlibrary(dplyr)\nlibrary(tidyverse)\nlibrary(stringr)\n\nlibrary(gt)\nlibrary(knitr)\nlibrary(tibble)\n```\n:::\n\n\nPara conectar la base de datos se añaden los parámetros de conexión:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndb_host <- \"localhost\"  # IP de la DB\ndb_port <- 5432         # PostgreSQL puerto\ndb_name <- \"HospMex\"    # Nombre de la db\ndb_user <- \"postgres\"   # Usuario de la db\ndb_pass <- \"root\"       # Contraseña\n```\n:::\n\n\nLa conexión se realiza con el siguiente código:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconn <- dbConnect(\n  RPostgres::Postgres(),\n  dbname = db_name,\n  host = db_host,\n  port = db_port,\n  user = db_user,\n  password = db_pass\n)\n```\n:::\n\n\nSe aprecia que están las quince tablas que componen la base de datos y algunas tablas adicionales relacionadas a la variable espacial de la base de datos (por complemento de PostGIS). Las tablas adicionales son: geography_columns, geometry_columns, spatial_ref_sys. El siguiente código selecciona las tablas desde `information_schema.columns` para obtener el nombre de cada una de las tablas y su cantidad de columnas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresumen <- dbGetQuery(conn, \"SELECT \n    table_name, \n    COUNT(*) AS column_count\nFROM \n    information_schema.columns\nWHERE \n    table_schema = 'public'\nGROUP BY \n    table_name\nORDER BY \n    table_name;\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\nTable: Tabla de la base de datos\n\n|table_name                           | column_count|\n|:------------------------------------|------------:|\n|dim_aislamiento                      |           10|\n|dim_antibioticos                     |            7|\n|dim_causa_muerte                     |            3|\n|dim_causa_muerte_x_hospitalizacion   |            4|\n|dim_diagnosticos                     |            3|\n|dim_diagnosticos_x_hospitalizacion   |            4|\n|dim_hospitalizacion                  |           16|\n|dim_muestra                          |           26|\n|dim_organismo                        |            5|\n|dim_paciente                         |            9|\n|dim_procedimiento                    |            3|\n|dim_procedimientos_x_hospitalizacion |            4|\n|dim_zona_geografica                  |            9|\n|fact_ast                             |           32|\n|fact_visita_paciente                 |           27|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnombres_de_tablas <- resumen$table_name\n\ntablas_db <- data.frame(nombreTabla=character(), \n                        nrows=integer(), \n                        stringsAsFactors=FALSE) \n\n\n\n\nfor (tabla_en_base_de_datos in nombres_de_tablas) {\n  valor <- dbGetQuery(conn, paste0(\"SELECT COUNT(*) FROM \",tabla_en_base_de_datos,\";\"))\n  tablas_db <- rbind(tablas_db, data.frame(tabla_en_base_de_datos, \n                                           valor))\n}\n\nknitr::kable(tablas_db, caption = \"Cantidad de registros por tabla\")\n```\n\n::: {.cell-output-display}\nTable: Cantidad de registros por tabla\n\n|tabla_en_base_de_datos               |   count|\n|:------------------------------------|-------:|\n|dim_aislamiento                      |   49691|\n|dim_antibioticos                     |     142|\n|dim_causa_muerte                     |    1786|\n|dim_causa_muerte_x_hospitalizacion   |   31059|\n|dim_diagnosticos                     |    7651|\n|dim_diagnosticos_x_hospitalizacion   | 1113290|\n|dim_hospitalizacion                  |  414444|\n|dim_muestra                          |  122269|\n|dim_organismo                        |     476|\n|dim_paciente                         |  264216|\n|dim_procedimiento                    |    3200|\n|dim_procedimientos_x_hospitalizacion |  647100|\n|dim_zona_geografica                  |     489|\n|fact_ast                             | 2338265|\n|fact_visita_paciente                 |  506013|\n:::\n:::\n\n\n## Análisis exploratorio\n\n### Integridad de los datos\n\nEl objetivo principal del análisis exploratorio de datos univariados es extraer las características básicas y patrones de los datos [@meloun2011]. Esto quiere decir que al analizar datos el primer paso es explorar que es lo que existe en las variables, sean estos univariados, bivariados o multivariados; para datos categóricos se resumen las proporciones para cada categoría y para datos cuantitativos se aplican técnicas para conocer las medidas de dispersión, centro y forma de los datos; además este análisis contribuye a comprender las relaciones entre las variables[@loftus2022].\n\nSe utiliza el siguiente código para cargar todas las tablas:\n\n\n::: {.cell}\n\n:::\n\n\nAl explorar la estructura de los datos es posible encontrar elementos que deben ser corregidos mediante la limpieza de datos. Un ejemplo de esto serían valores en una variable que representen lo mismo, pero que a nivel de sistema sean diferentes; por ejemplo un texto que diga [\"No se efectúa\"]{.underline} y otro que diga [\"No se efectùa\"]{.underline}. Al realizar un conteo de datos categóricos esto va a representar un problema, ya que crear dos categorías diferentes para un valor que representa lo mismo. Algunos casos repetitivos en cualquier base de datos son: tildes mal puestas, uso inconsistente de mayúsculas, mal uso de los espacios (puede ser un espacio adicional al inicio, en medio o al final del valor), entre otros.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnombres_columnas <- colnames(dim_aislamiento)\n\n# Para limpiar espacios al inicio, final y además espacios repetidos adentro del \"string\"\nfor (nombre in nombres_columnas) {\n  dim_aislamiento[,nombre] <- str_squish(dim_aislamiento[,nombre])\n  #print(sort(unique(dim_aislamiento[,nombre])))\n}\n```\n:::\n\n\nEste código puede aplicarse programáticamente para todas las tablas y sus respectivas columnas, aunque antes de hacerlo sería adecuado realizar una inspección manual para conocer que tipo de valores se estaría modificando.\n\n### Conteo de categorías: fact_ast\n\nEn la tabla de las pruebas de susceptibilidad antimicrobiana es posible realizar el conteo de algunas categorías relevantes. Antes de ello es adecuado revisar todas las columnas y realizar una posible descripción de cada una.\n\n\n::: {.cell}\n\n:::\n\n\n|                                       |                                                                                                                                                                                                                                                                                                                                          |\n|:--------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| **Nombres_de_columnas**               | **Descripción**                                                                                                                                                                                                                                                                                                                          |\n| id_paciente                           | Contiene un código de identificación anonimizada para el paciente                                                                                                                                                                                                                                                                        |\n| identificacion                        | Identificación del paciente. Esta columna existe pero no posee ninguna información de identificación (está completamente vacía) para efectos de este análisis                                                                                                                                                                            |\n| id_muestra                            | Código de identificación de la muestra, sirve para asociar con la tabla que posee los registros sobre las muestras                                                                                                                                                                                                                       |\n| codigo_interno_muestra                | Código interno de la muestra, posiblemente se refiere a un código utilizado en los sistemas hospitalarios                                                                                                                                                                                                                                |\n| numero_muestra                        | El número de la muestra aparentemente es lo mismo que el código interno de la muestra                                                                                                                                                                                                                                                    |\n| id_aislamiento                        | Identificación del aislamiento, sirve para realizar consultas con la tabla dim_aislamiento                                                                                                                                                                                                                                               |\n| codigo_interno_aislamiento            | Similar al caso de código interno muestra, posiblemente una codificación utilizada en los sistemas del hospital                                                                                                                                                                                                                          |\n| numero_aislamiento                    | Número del aislamiento. Esta columna podría ser removida de la tabla fact_ast ya que contiene información repetitiva que podría ser obtenida mediante una consulta con la tabla dim_aislamiento y la columna id_aislamiento                                                                                                              |\n| qgs_fid                               | qgs_fid podría referirse a una columna de codificación con códigos de provincia, cantón y distrito (vienen de todo tipo de unidad espacial, no es consistente) relacionada a alguna salida con datos del software QGIS.                                                                                                                  |\n| codigo_distrito                       | El código de distrito se refiere a la codificación del distrito que usualmente tiene la estructura XX-YY-ZZ donde XX es el número de la provincia (por ejemplo 04 sería Heredia), YY es el número de cantón (por ejemplo 06 es San Isidro) y ZZ se refiere al distrito (por ejemplo, 02 podría ser el distrito de San José de San Isidro |\n| fecha_admision                        | Podría ser la fecha de admisión del paciente                                                                                                                                                                                                                                                                                             |\n| fecha_muestra                         | Fecha de la muestra (fecha del resultado, fecha del análisis o de la recepción de la muestra)                                                                                                                                                                                                                                            |\n| fecha_recepcion                       | Fecha de recepción de la muestra (o del paciente)                                                                                                                                                                                                                                                                                        |\n| fecha_final                           | Fecha final (no es claro a que podría referirse con final)                                                                                                                                                                                                                                                                               |\n| probabilidad                          | Consultar sobre esta                                                                                                                                                                                                                                                                                                                     |\n| categoria_no_expertizada              | Consultar sobre esta columna. Categoría no expertizada tiene diferente valores como un '+' y un '-' entonces podría referirse a si es o no es resistente.                                                                                                                                                                                |\n| concentracion_minima_inivitoria_final | Consultar. Podría referirse a la concentración mínima inhibitoria de los antibióticas para controlar el crecimiento microbiano mediante agentes antimicrobianos.                                                                                                                                                                         |\n| halo                                  | Consultar sobre esta columna y terminología adecuada. halo podría referirse a la zona de inhibición que rodea un agente antimicrobiano                                                                                                                                                                                                   |\n| categoria_final                       | categoría final podría referirse a si es o no es resistente entre otros valores como: Derreprimida, BLEE tipo CTX-M, AMP C inducible                                                                                                                                                                                                     |\n| tipo_analisis                         | Consultar. Tipo de análisis puede referirse al análisis realizado para dterminar si es resistente o no                                                                                                                                                                                                                                   |\n| metodo_determinacion                  | Consultar. Método determinación se refiere si el método fue manual o instrumental (o si no se cuenta con la información del método)                                                                                                                                                                                                      |\n| edad                                  | Edad                                                                                                                                                                                                                                                                                                                                     |\n| EDAD (AST)                            | Consultar. Edad AST podría referirse a grupos de edad relacionados al análisis de las pruebas de susceptibilidad.                                                                                                                                                                                                                        |\n| grupo_edad                            | Grupos de edad. Esto podría servir para realizar una pirámide poblacional                                                                                                                                                                                                                                                                |\n| orden_edad                            | orden de edad podría referirse a un código que se refiere a diversos grupos de edad, mientras más alta la edad, más alto el orden de edad.                                                                                                                                                                                               |\n| grupo_edad(2)                         | grupo_edad(2)                                                                                                                                                                                                                                                                                                                            |\n| categoria_final_etiqueta              | Categoría final etiqueta indica si es resistente, sensible, pendiente, intermedio o si es NaN                                                                                                                                                                                                                                            |\n| Distrito_pacientes                    | Nombre del distrito del paciente (nombre textualmente, no código del distrito)                                                                                                                                                                                                                                                           |\n| id_microorganismo                     | id del microorganismo, sirve para identificar el microorgnaismo y realizar consultas                                                                                                                                                                                                                                                     |\n| codigo_microorganismo                 | código del microorganismo sirve para realizar consultas con la tabla de dim_organismos                                                                                                                                                                                                                                                   |\n| id_antimicrobiano                     | id del antimicrobiano, para identificar y realizAR consultas con la tabla dim_antibioticos                                                                                                                                                                                                                                               |\n| codigo_antimicrobiano                 | código antimicrobiano es el código textual corto del antimicrobiano.                                                                                                                                                                                                                                                                     |\n\nPor ejemplo, para la columna método determinación la tabla sería la siguiente:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfact_ast %>% count(metodo_determinacion)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  metodo_determinacion       n\n1          Instrumento  758079\n2          manualmente   19082\n3                  NaN 1561104\n```\n:::\n\n```{.r .cell-code}\nfact_ast %>% count(metodo_determinacion) %>%\n    ggplot( aes(x=reorder(metodo_determinacion, n), y=n)) +\n    geom_bar(stat=\"identity\", fill=\"#f68060\", alpha=.6, width=.4) +\n    coord_flip() +\n    xlab(\"\") +\n    theme_bw()+\n    ggtitle(\"Método de determinación\")\n```\n\n::: {.cell-output-display}\n![](EDA_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nPara la columna \"categoria_final_etiqueta\" se obtiene el siguiente resultado\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfact_ast %>% count(categoria_final_etiqueta)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  categoria_final_etiqueta       n\n1               Intermedio   70655\n2                      NaN    4291\n3                PENDIENTE  150829\n4               Resistente  593765\n5                 Sensible 1518725\n```\n:::\n\n```{.r .cell-code}\nfact_ast %>% count(categoria_final_etiqueta) %>%\n    ggplot( aes(x=reorder(categoria_final_etiqueta, n), y=n)) +\n    geom_bar(stat=\"identity\", fill=\"#f68060\", alpha=.6, width=.4) +\n    coord_flip() +\n    xlab(\"\") +\n    theme_bw()+\n    ggtitle(\"Categoría final etiqueta\")\n```\n\n::: {.cell-output-display}\n![](EDA_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nPara la columna \"categoria_no_expertizada\" se obtiene el siguiente resultado\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfact_ast %>% count(categoria_no_expertizada)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  categoria_no_expertizada       n\n1                        -    7963\n2                        +    5833\n3                        I   14157\n4                      NaN 1976732\n5                        R  103861\n6                        S  229719\n```\n:::\n\n```{.r .cell-code}\nfact_ast %>% count(categoria_no_expertizada) %>%\n    ggplot( aes(x=reorder(categoria_no_expertizada, n), y=n)) +\n    geom_bar(stat=\"identity\", fill=\"#f68060\", alpha=.6, width=.4) +\n    coord_flip() +\n    xlab(\"\") +\n    theme_bw()+\n    ggtitle(\"Categoría no expertizada\")\n```\n\n::: {.cell-output-display}\n![](EDA_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\nPara efectos del trabajo final de graduación denominado \"Análisis de la resistencia antimicrobiana en el área de cobertura del Hospital México durante el período 2006-2021\" las tablas de mayor interés son: fact_ast (que contiene los resultados de las pruebas de susceptibilidad antimicrobiana).\n\nLo siguientes pasos para el trabajo con esta base de datos son:\n\n-   Limpieza de tablas que incluyan los errores mencionados\n\n-   Convertir columnas de fechas a tipo fecha\n\n-   Modificar la tabla de diagnósticos para añadir grupos más grandes de diagnósticos según la tabla ICD-10-CM. Esta clasificación es la que se utiliza en la tabla, pero igual sería necesario consultar.\n\n    -   Esto facilitaría el análisis en grupos más generales y encontrar posibles patrones.\n",
    "supporting": [
      "EDA_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel Ramírez">

<title>R, Geografía y Data - Análisis Exploratorio de Datos AMR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">R, Geografía y Data</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Buscar"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Navegación de palanca" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Gusapno" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Gabo06719007" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Análisis Exploratorio de Datos AMR</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">SIG</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor/a</div>
      <div class="quarto-title-meta-contents">
               <p>Gabriel Ramírez </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Fecha de publicación</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2 de abril de 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenidos</h2>
   
  <ul>
  <li><a href="#análisis-descriptivo-de-datos-hospital-méxico" id="toc-análisis-descriptivo-de-datos-hospital-méxico" class="nav-link active" data-scroll-target="#análisis-descriptivo-de-datos-hospital-méxico">Análisis Descriptivo de Datos Hospital México</a></li>
  <li><a href="#análisis-exploratorio" id="toc-análisis-exploratorio" class="nav-link" data-scroll-target="#análisis-exploratorio">Análisis exploratorio</a>
  <ul class="collapse">
  <li><a href="#integridad-de-los-datos" id="toc-integridad-de-los-datos" class="nav-link" data-scroll-target="#integridad-de-los-datos">Integridad de los datos</a></li>
  <li><a href="#conteo-de-categorías-fact_ast" id="toc-conteo-de-categorías-fact_ast" class="nav-link" data-scroll-target="#conteo-de-categorías-fact_ast">Conteo de categorías: fact_ast</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="análisis-descriptivo-de-datos-hospital-méxico" class="level2">
<h2 class="anchored" data-anchor-id="análisis-descriptivo-de-datos-hospital-méxico">Análisis Descriptivo de Datos Hospital México</h2>
<p>Se realiza un análisis descriptivo de la base de datos de los pacientes del Hospital México y las posibles resistencias y/o multiresistencias de los microorganismos a los antimicrobianos. Librerías utilizadas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI) <span class="co"># Interfaz de base de datos</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres) <span class="co"># Para conectar con PSQL</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># Spatial Features, para manejar datos espaciales</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#library(rgeos) # Remover</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx) <span class="co"># Para abrir documentos de Excel</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table) <span class="co"># Para manejo de tablas</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#library(rgdal) # Remover</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para conectar la base de datos se añaden los parámetros de conexión:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>db_host <span class="ot">&lt;-</span> <span class="st">"localhost"</span>  <span class="co"># IP de la DB</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>db_port <span class="ot">&lt;-</span> <span class="dv">5432</span>         <span class="co"># PostgreSQL puerto</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>db_name <span class="ot">&lt;-</span> <span class="st">"HospMex"</span>    <span class="co"># Nombre de la db</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>db_user <span class="ot">&lt;-</span> <span class="st">"postgres"</span>   <span class="co"># Usuario de la db</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>db_pass <span class="ot">&lt;-</span> <span class="st">"root"</span>       <span class="co"># Contraseña</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La conexión se realiza con el siguiente código:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  RPostgres<span class="sc">::</span><span class="fu">Postgres</span>(),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbname =</span> db_name,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">host =</span> db_host,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">port =</span> db_port,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">user =</span> db_user,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">password =</span> db_pass</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se aprecia que están las quince tablas que componen la base de datos y algunas tablas adicionales relacionadas a la variable espacial de la base de datos (por complemento de PostGIS). Las tablas adicionales son: geography_columns, geometry_columns, spatial_ref_sys. El siguiente código selecciona las tablas desde <code>information_schema.columns</code> para obtener el nombre de cada una de las tablas y su cantidad de columnas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>resumen <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">"SELECT </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">    table_name, </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(*) AS column_count</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">FROM </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">    information_schema.columns</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="st">    table_schema = 'public'</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="st">    table_name</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="st">    table_name;"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Tabla de la base de datos</caption>
<thead>
<tr class="header">
<th style="text-align: left;">table_name</th>
<th style="text-align: right;">column_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dim_aislamiento</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_antibioticos</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_causa_muerte</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_causa_muerte_x_hospitalizacion</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_diagnosticos</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_diagnosticos_x_hospitalizacion</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_hospitalizacion</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_muestra</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_organismo</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_paciente</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_procedimiento</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_procedimientos_x_hospitalizacion</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_zona_geografica</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">fact_ast</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fact_visita_paciente</td>
<td style="text-align: right;">27</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nombres_de_tablas <span class="ot">&lt;-</span> resumen<span class="sc">$</span>table_name</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>tablas_db <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">nombreTabla=</span><span class="fu">character</span>(), </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrows=</span><span class="fu">integer</span>(), </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (tabla_en_base_de_datos <span class="cf">in</span> nombres_de_tablas) {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  valor <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="fu">paste0</span>(<span class="st">"SELECT COUNT(*) FROM "</span>,tabla_en_base_de_datos,<span class="st">";"</span>))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  tablas_db <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tablas_db, <span class="fu">data.frame</span>(tabla_en_base_de_datos, </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                           valor))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(tablas_db, <span class="at">caption =</span> <span class="st">"Cantidad de registros por tabla"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Cantidad de registros por tabla</caption>
<thead>
<tr class="header">
<th style="text-align: left;">tabla_en_base_de_datos</th>
<th style="text-align: right;">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dim_aislamiento</td>
<td style="text-align: right;">49691</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_antibioticos</td>
<td style="text-align: right;">142</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_causa_muerte</td>
<td style="text-align: right;">1786</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_causa_muerte_x_hospitalizacion</td>
<td style="text-align: right;">31059</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_diagnosticos</td>
<td style="text-align: right;">7651</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_diagnosticos_x_hospitalizacion</td>
<td style="text-align: right;">1113290</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_hospitalizacion</td>
<td style="text-align: right;">414444</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_muestra</td>
<td style="text-align: right;">122269</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_organismo</td>
<td style="text-align: right;">476</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_paciente</td>
<td style="text-align: right;">264216</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_procedimiento</td>
<td style="text-align: right;">3200</td>
</tr>
<tr class="even">
<td style="text-align: left;">dim_procedimientos_x_hospitalizacion</td>
<td style="text-align: right;">647100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dim_zona_geografica</td>
<td style="text-align: right;">489</td>
</tr>
<tr class="even">
<td style="text-align: left;">fact_ast</td>
<td style="text-align: right;">2338265</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fact_visita_paciente</td>
<td style="text-align: right;">506013</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="análisis-exploratorio" class="level2">
<h2 class="anchored" data-anchor-id="análisis-exploratorio">Análisis exploratorio</h2>
<section id="integridad-de-los-datos" class="level3">
<h3 class="anchored" data-anchor-id="integridad-de-los-datos">Integridad de los datos</h3>
<p>El objetivo principal del análisis exploratorio de datos univariados es extraer las características básicas y patrones de los datos <span class="citation" data-cites="loftus2022">(<a href="#ref-loftus2022" role="doc-biblioref">Loftus, 2022</a>)</span>. Esto quiere decir que al analizar datos el primer paso es explorar que es lo que existe en las variables, sean estos univariados, bivariados o multivariados; para datos categóricos se resumen las proporciones para cada categoría y para datos cuantitativos se aplican técnicas para conocer las medidas de dispersión, centro y forma de los datos; además este análisis contribuye a comprender las relaciones entre las variables<span class="citation" data-cites="loftus2022">(<a href="#ref-loftus2022" role="doc-biblioref">Loftus, 2022</a>)</span>.</p>
<p>Se utiliza el siguiente código para cargar todas las tablas:</p>
<p>Al explorar la estructura de los datos es posible encontrar elementos que deben ser corregidos mediante la limpieza de datos. Un ejemplo de esto serían valores en una variable que representen lo mismo, pero que a nivel de sistema sean diferentes; por ejemplo un texto que diga <u>“No se efectúa”</u> y otro que diga <u>“No se efectùa”</u>. Al realizar un conteo de datos categóricos esto va a representar un problema, ya que crear dos categorías diferentes para un valor que representa lo mismo. Algunos casos repetitivos en cualquier base de datos son: tildes mal puestas, uso inconsistente de mayúsculas, mal uso de los espacios (puede ser un espacio adicional al inicio, en medio o al final del valor), entre otros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>nombres_columnas <span class="ot">&lt;-</span> <span class="fu">colnames</span>(dim_aislamiento)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Para limpiar espacios al inicio, final y además espacios repetidos adentro del "string"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nombre <span class="cf">in</span> nombres_columnas) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  dim_aislamiento[,nombre] <span class="ot">&lt;-</span> <span class="fu">str_squish</span>(dim_aislamiento[,nombre])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(sort(unique(dim_aislamiento[,nombre])))</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este código puede aplicarse programáticamente para todas las tablas y sus respectivas columnas, aunque antes de hacerlo sería adecuado realizar una inspección manual para conocer que tipo de valores se estaría modificando.</p>
</section>
<section id="conteo-de-categorías-fact_ast" class="level3">
<h3 class="anchored" data-anchor-id="conteo-de-categorías-fact_ast">Conteo de categorías: fact_ast</h3>
<p>En la tabla de las pruebas de susceptibilidad antimicrobiana es posible realizar el conteo de algunas categorías relevantes. Antes de ello es adecuado revisar todas las columnas y realizar una posible descripción de cada una.</p>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 89%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Nombres_de_columnas</strong></td>
<td style="text-align: left;"><strong>Descripción</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">id_paciente</td>
<td style="text-align: left;">Contiene un código de identificación anonimizada para el paciente</td>
</tr>
<tr class="odd">
<td style="text-align: left;">identificacion</td>
<td style="text-align: left;">Identificación del paciente. Esta columna existe pero no posee ninguna información de identificación (está completamente vacía) para efectos de este análisis</td>
</tr>
<tr class="even">
<td style="text-align: left;">id_muestra</td>
<td style="text-align: left;">Código de identificación de la muestra, sirve para asociar con la tabla que posee los registros sobre las muestras</td>
</tr>
<tr class="odd">
<td style="text-align: left;">codigo_interno_muestra</td>
<td style="text-align: left;">Código interno de la muestra, posiblemente se refiere a un código utilizado en los sistemas hospitalarios</td>
</tr>
<tr class="even">
<td style="text-align: left;">numero_muestra</td>
<td style="text-align: left;">El número de la muestra aparentemente es lo mismo que el código interno de la muestra</td>
</tr>
<tr class="odd">
<td style="text-align: left;">id_aislamiento</td>
<td style="text-align: left;">Identificación del aislamiento, sirve para realizar consultas con la tabla dim_aislamiento</td>
</tr>
<tr class="even">
<td style="text-align: left;">codigo_interno_aislamiento</td>
<td style="text-align: left;">Similar al caso de código interno muestra, posiblemente una codificación utilizada en los sistemas del hospital</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numero_aislamiento</td>
<td style="text-align: left;">Número del aislamiento. Esta columna podría ser removida de la tabla fact_ast ya que contiene información repetitiva que podría ser obtenida mediante una consulta con la tabla dim_aislamiento y la columna id_aislamiento</td>
</tr>
<tr class="even">
<td style="text-align: left;">qgs_fid</td>
<td style="text-align: left;">qgs_fid podría referirse a una columna de codificación con códigos de provincia, cantón y distrito (vienen de todo tipo de unidad espacial, no es consistente) relacionada a alguna salida con datos del software QGIS.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">codigo_distrito</td>
<td style="text-align: left;">El código de distrito se refiere a la codificación del distrito que usualmente tiene la estructura XX-YY-ZZ donde XX es el número de la provincia (por ejemplo 04 sería Heredia), YY es el número de cantón (por ejemplo 06 es San Isidro) y ZZ se refiere al distrito (por ejemplo, 02 podría ser el distrito de San José de San Isidro</td>
</tr>
<tr class="even">
<td style="text-align: left;">fecha_admision</td>
<td style="text-align: left;">Podría ser la fecha de admisión del paciente</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fecha_muestra</td>
<td style="text-align: left;">Fecha de la muestra (fecha del resultado, fecha del análisis o de la recepción de la muestra)</td>
</tr>
<tr class="even">
<td style="text-align: left;">fecha_recepcion</td>
<td style="text-align: left;">Fecha de recepción de la muestra (o del paciente)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fecha_final</td>
<td style="text-align: left;">Fecha final (no es claro a que podría referirse con final)</td>
</tr>
<tr class="even">
<td style="text-align: left;">probabilidad</td>
<td style="text-align: left;">Consultar sobre esta</td>
</tr>
<tr class="odd">
<td style="text-align: left;">categoria_no_expertizada</td>
<td style="text-align: left;">Consultar sobre esta columna. Categoría no expertizada tiene diferente valores como un ‘+’ y un ‘-’ entonces podría referirse a si es o no es resistente.</td>
</tr>
<tr class="even">
<td style="text-align: left;">concentracion_minima_inivitoria_final</td>
<td style="text-align: left;">Consultar. Podría referirse a la concentración mínima inhibitoria de los antibióticas para controlar el crecimiento microbiano mediante agentes antimicrobianos.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">halo</td>
<td style="text-align: left;">Consultar sobre esta columna y terminología adecuada. halo podría referirse a la zona de inhibición que rodea un agente antimicrobiano</td>
</tr>
<tr class="even">
<td style="text-align: left;">categoria_final</td>
<td style="text-align: left;">categoría final podría referirse a si es o no es resistente entre otros valores como: Derreprimida, BLEE tipo CTX-M, AMP C inducible</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tipo_analisis</td>
<td style="text-align: left;">Consultar. Tipo de análisis puede referirse al análisis realizado para dterminar si es resistente o no</td>
</tr>
<tr class="even">
<td style="text-align: left;">metodo_determinacion</td>
<td style="text-align: left;">Consultar. Método determinación se refiere si el método fue manual o instrumental (o si no se cuenta con la información del método)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">edad</td>
<td style="text-align: left;">Edad</td>
</tr>
<tr class="even">
<td style="text-align: left;">EDAD (AST)</td>
<td style="text-align: left;">Consultar. Edad AST podría referirse a grupos de edad relacionados al análisis de las pruebas de susceptibilidad.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grupo_edad</td>
<td style="text-align: left;">Grupos de edad. Esto podría servir para realizar una pirámide poblacional</td>
</tr>
<tr class="even">
<td style="text-align: left;">orden_edad</td>
<td style="text-align: left;">orden de edad podría referirse a un código que se refiere a diversos grupos de edad, mientras más alta la edad, más alto el orden de edad.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grupo_edad(2)</td>
<td style="text-align: left;">grupo_edad(2)</td>
</tr>
<tr class="even">
<td style="text-align: left;">categoria_final_etiqueta</td>
<td style="text-align: left;">Categoría final etiqueta indica si es resistente, sensible, pendiente, intermedio o si es NaN</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Distrito_pacientes</td>
<td style="text-align: left;">Nombre del distrito del paciente (nombre textualmente, no código del distrito)</td>
</tr>
<tr class="even">
<td style="text-align: left;">id_microorganismo</td>
<td style="text-align: left;">id del microorganismo, sirve para identificar el microorgnaismo y realizar consultas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">codigo_microorganismo</td>
<td style="text-align: left;">código del microorganismo sirve para realizar consultas con la tabla de dim_organismos</td>
</tr>
<tr class="even">
<td style="text-align: left;">id_antimicrobiano</td>
<td style="text-align: left;">id del antimicrobiano, para identificar y realizAR consultas con la tabla dim_antibioticos</td>
</tr>
<tr class="odd">
<td style="text-align: left;">codigo_antimicrobiano</td>
<td style="text-align: left;">código antimicrobiano es el código textual corto del antimicrobiano.</td>
</tr>
</tbody>
</table>
<p>Por ejemplo, para la columna método determinación la tabla sería la siguiente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fact_ast <span class="sc">%&gt;%</span> <span class="fu">count</span>(metodo_determinacion)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  metodo_determinacion       n
1          Instrumento  758079
2          manualmente   19082
3                  NaN 1561104</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fact_ast <span class="sc">%&gt;%</span> <span class="fu">count</span>(metodo_determinacion) <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(metodo_determinacion, n), <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">fill=</span><span class="st">"#f68060"</span>, <span class="at">alpha=</span>.<span class="dv">6</span>, <span class="at">width=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Método de determinación"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para la columna “categoria_final_etiqueta” se obtiene el siguiente resultado</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fact_ast <span class="sc">%&gt;%</span> <span class="fu">count</span>(categoria_final_etiqueta)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  categoria_final_etiqueta       n
1               Intermedio   70655
2                      NaN    4291
3                PENDIENTE  150829
4               Resistente  593765
5                 Sensible 1518725</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fact_ast <span class="sc">%&gt;%</span> <span class="fu">count</span>(categoria_final_etiqueta) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(categoria_final_etiqueta, n), <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">fill=</span><span class="st">"#f68060"</span>, <span class="at">alpha=</span>.<span class="dv">6</span>, <span class="at">width=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Categoría final etiqueta"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para la columna “categoria_no_expertizada” se obtiene el siguiente resultado</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fact_ast <span class="sc">%&gt;%</span> <span class="fu">count</span>(categoria_no_expertizada)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  categoria_no_expertizada       n
1                        -    7963
2                        +    5833
3                        I   14157
4                      NaN 1976732
5                        R  103861
6                        S  229719</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fact_ast <span class="sc">%&gt;%</span> <span class="fu">count</span>(categoria_no_expertizada) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(categoria_no_expertizada, n), <span class="at">y=</span>n)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">fill=</span><span class="st">"#f68060"</span>, <span class="at">alpha=</span>.<span class="dv">6</span>, <span class="at">width=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Categoría no expertizada"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Para efectos del trabajo final de graduación denominado “Análisis de la resistencia antimicrobiana en el área de cobertura del Hospital México durante el período 2006-2021” una de las tablas de mayor interés es fact_ast (que contiene los resultados de las pruebas de susceptibilidad antimicrobiana) y es necesario revisar la misma a profundidad.</p>
<p>Lo siguientes pasos para el trabajo con esta base de datos son:</p>
<ul>
<li><p>Limpieza de tablas que incluyan los errores mencionados</p></li>
<li><p>Convertir columnas de fechas a tipo fecha</p></li>
<li><p>Modificar la tabla de diagnósticos para añadir grupos más grandes de diagnósticos según la tabla ICD-10-CM. Esta clasificación es la que se utiliza en la tabla, pero igual sería necesario consultar.</p>
<ul>
<li>Esto facilitaría el análisis en grupos más generales y encontrar posibles patrones.</li>
</ul></li>
</ul>
<p>También si fuera posible confirmar la descripción de las columnas de esta tabla sería útil para el desarrollo del análisis</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Referencias</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list">
<div id="ref-loftus2022" class="csl-entry" role="listitem">
Loftus, S. C. (2022). <em>Exploratory data analyses: describing our data</em> (pp. 47-72). Elsevier. <a href="https://doi.org/10.1016/b978-0-12-820788-8.00017-1">https://doi.org/10.1016/b978-0-12-820788-8.00017-1</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>